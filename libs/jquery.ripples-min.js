/**
 * jQuery Ripples plugin v0.6.3 / https://github.com/sirxemic/jquery.ripples
 * MIT License
 * @author sirxemic / https://sirxemic.com/
 */

(function(a,b){typeof exports==='object'&&typeof module!=='undefined'?b(require('jquery')):typeof define==='function'&&define.amd?define(['jquery'],b):(b(a.$))}(this,(function($){'use strict';$=$&&'default'in $?$['default']:$;var l;var m=$(window);function isPercentage(a){return a[a.length-1]=='%'}function loadConfig(){var e=document.createElement('canvas');l=e.getContext('webgl')||e.getContext('experimental-webgl');if(!l){return null}var f={};['OES_texture_float','OES_texture_half_float','OES_texture_float_linear','OES_texture_half_float_linear'].forEach(function(a){var b=l.getExtension(a);if(b){f[a]=b}});if(!f.OES_texture_float){return null}var g=[];function createConfig(a,b,c){var d='OES_texture_'+a,nameLinear=d+'_linear',linearSupport=nameLinear in f,configExtensions=[d];if(linearSupport){configExtensions.push(nameLinear)}return{type:b,arrayType:c,linearSupport:linearSupport,extensions:configExtensions}}g.push(createConfig('float',l.FLOAT,Float32Array));if(f.OES_texture_half_float){g.push(createConfig('half_float',f.OES_texture_half_float.HALF_FLOAT_OES,null))}var h=l.createTexture();var j=l.createFramebuffer();l.bindFramebuffer(l.FRAMEBUFFER,j);l.bindTexture(l.TEXTURE_2D,h);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE);var k=null;for(var i=0;i<g.length;i++){l.texImage2D(l.TEXTURE_2D,0,l.RGBA,32,32,0,l.RGBA,g[i].type,null);l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,h,0);if(l.checkFramebufferStatus(l.FRAMEBUFFER)===l.FRAMEBUFFER_COMPLETE){k=g[i];break}}return k}function createImageData(a,b){try{return new ImageData(a,b)}catch(e){var c=document.createElement('canvas');return c.getContext('2d').createImageData(a,b)}}function translateBackgroundPosition(b){var c=b.split(' ');if(c.length===1){switch(b){case'center':return['50%','50%'];case'top':return['50%','0'];case'bottom':return['50%','100%'];case'left':return['0','50%'];case'right':return['100%','50%'];default:return[b,'50%']}}else{return c.map(function(a){switch(b){case'center':return'50%';case'top':case'left':return'0';case'right':case'bottom':return'100%';default:return a}})}}function createProgram(d,e,f){function compileSource(a,b){var c=l.createShader(a);l.shaderSource(c,b);l.compileShader(c);if(!l.getShaderParameter(c,l.COMPILE_STATUS)){throw new Error('compile error: '+l.getShaderInfoLog(c));}return c}var g={};g.id=l.createProgram();l.attachShader(g.id,compileSource(l.VERTEX_SHADER,d));l.attachShader(g.id,compileSource(l.FRAGMENT_SHADER,e));l.linkProgram(g.id);if(!l.getProgramParameter(g.id,l.LINK_STATUS)){throw new Error('link error: '+l.getProgramInfoLog(g.id));}g.uniforms={};g.locations={};l.useProgram(g.id);l.enableVertexAttribArray(0);var h,name,regex=/uniform (\w+) (\w+)/g,shaderCode=d+e;while((h=regex.exec(shaderCode))!=null){name=h[2];g.locations[name]=l.getUniformLocation(g.id,name)}return g}function bindTexture(a,b){l.activeTexture(l.TEXTURE0+(b||0));l.bindTexture(l.TEXTURE_2D,a)}function extractUrl(a){var b=/url\(["']?([^"']*)["']?\)/.exec(a);if(b==null){return null}return b[1]}function isDataUri(a){return a.match(/^data:/)}var n=loadConfig();var o=createImageData(32,32);$('head').prepend('<style>.jquery-ripples { position: relative; z-index: 0; }</style>');var p=function(b,c){var d=this;this.$el=$(b);this.interactive=c.interactive;this.resolution=c.resolution;this.textureDelta=new Float32Array([1/this.resolution,1/this.resolution]);this.perturbance=c.perturbance;this.dropRadius=c.dropRadius;this.crossOrigin=c.crossOrigin;this.imageUrl=c.imageUrl;var e=document.createElement('canvas');e.width=this.$el.innerWidth();e.height=this.$el.innerHeight();this.canvas=e;this.$canvas=$(e);this.$canvas.css({position:'absolute',left:0,top:0,right:0,bottom:0,zIndex:-1});this.$el.addClass('jquery-ripples').append(e);this.context=l=e.getContext('webgl')||e.getContext('experimental-webgl');n.extensions.forEach(function(a){l.getExtension(a)});this.updateSize=this.updateSize.bind(this);$(window).on('resize',this.updateSize);this.textures=[];this.framebuffers=[];this.bufferWriteIndex=0;this.bufferReadIndex=1;var f=n.arrayType;var g=f?new f(this.resolution*this.resolution*4):null;for(var i=0;i<2;i++){var h=l.createTexture();var j=l.createFramebuffer();l.bindFramebuffer(l.FRAMEBUFFER,j);l.bindTexture(l.TEXTURE_2D,h);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,n.linearSupport?l.LINEAR:l.NEAREST);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,n.linearSupport?l.LINEAR:l.NEAREST);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE);l.texImage2D(l.TEXTURE_2D,0,l.RGBA,this.resolution,this.resolution,0,l.RGBA,n.type,g);l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,h,0);this.textures.push(h);this.framebuffers.push(j)}this.quad=l.createBuffer();l.bindBuffer(l.ARRAY_BUFFER,this.quad);l.bufferData(l.ARRAY_BUFFER,new Float32Array([-1,-1,+1,-1,+1,+1,-1,+1]),l.STATIC_DRAW);this.initShaders();this.initTexture();this.setTransparentTexture();this.loadImage();l.clearColor(0,0,0,0);l.blendFunc(l.SRC_ALPHA,l.ONE_MINUS_SRC_ALPHA);this.visible=true;this.running=true;this.inited=true;this.destroyed=false;this.setupPointerEvents();function step(){if(!d.destroyed){d.step();requestAnimationFrame(step)}}requestAnimationFrame(step)};p.DEFAULTS={imageUrl:null,resolution:256,dropRadius:20,perturbance:0.03,interactive:true,crossOrigin:''};p.prototype={setupPointerEvents:function(){var c=this;function pointerEventsEnabled(){return c.visible&&c.running&&c.interactive}function dropAtPointer(a,b){if(pointerEventsEnabled()){c.dropAtPointer(a,c.dropRadius*(b?1.5:1),(b?0.14:0.01))}}this.$el.on('mousemove.ripples',function(e){dropAtPointer(e)}).on('touchmove.ripples touchstart.ripples',function(e){var a=e.originalEvent.changedTouches;for(var i=0;i<a.length;i++){dropAtPointer(a[i])}}).on('mousedown.ripples',function(e){dropAtPointer(e,true)})},loadImage:function(){var b=this;l=this.context;var c=this.imageUrl||extractUrl(this.originalCssBackgroundImage)||extractUrl(this.$el.css('backgroundImage'));if(c==this.imageSource){return}this.imageSource=c;if(!this.imageSource){this.setTransparentTexture();return}var d=new Image;d.onload=function(){l=b.context;function isPowerOfTwo(x){return(x&(x-1))==0}var a=(isPowerOfTwo(d.width)&&isPowerOfTwo(d.height))?l.REPEAT:l.CLAMP_TO_EDGE;l.bindTexture(l.TEXTURE_2D,b.backgroundTexture);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,a);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,a);l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,d);b.backgroundWidth=d.width;b.backgroundHeight=d.height;b.hideCssBackground()};d.onerror=function(){l=b.context;b.setTransparentTexture()};d.crossOrigin=isDataUri(this.imageSource)?null:this.crossOrigin;d.src=this.imageSource},step:function(){l=this.context;if(!this.visible){return}this.computeTextureBoundaries();if(this.running){this.update()}this.render()},drawQuad:function(){l.bindBuffer(l.ARRAY_BUFFER,this.quad);l.vertexAttribPointer(0,2,l.FLOAT,false,0,0);l.drawArrays(l.TRIANGLE_FAN,0,4)},render:function(){l.bindFramebuffer(l.FRAMEBUFFER,null);l.viewport(0,0,this.canvas.width,this.canvas.height);l.enable(l.BLEND);l.clear(l.COLOR_BUFFER_BIT|l.DEPTH_BUFFER_BIT);l.useProgram(this.renderProgram.id);bindTexture(this.backgroundTexture,0);bindTexture(this.textures[0],1);l.uniform1f(this.renderProgram.locations.perturbance,this.perturbance);l.uniform2fv(this.renderProgram.locations.topLeft,this.renderProgram.uniforms.topLeft);l.uniform2fv(this.renderProgram.locations.bottomRight,this.renderProgram.uniforms.bottomRight);l.uniform2fv(this.renderProgram.locations.containerRatio,this.renderProgram.uniforms.containerRatio);l.uniform1i(this.renderProgram.locations.samplerBackground,0);l.uniform1i(this.renderProgram.locations.samplerRipples,1);this.drawQuad();l.disable(l.BLEND)},update:function(){l.viewport(0,0,this.resolution,this.resolution);l.bindFramebuffer(l.FRAMEBUFFER,this.framebuffers[this.bufferWriteIndex]);bindTexture(this.textures[this.bufferReadIndex]);l.useProgram(this.updateProgram.id);this.drawQuad();this.swapBufferIndices()},swapBufferIndices:function(){this.bufferWriteIndex=1-this.bufferWriteIndex;this.bufferReadIndex=1-this.bufferReadIndex},computeTextureBoundaries:function(){var a=this.$el.css('background-size');var b=this.$el.css('background-attachment');var c=translateBackgroundPosition(this.$el.css('background-position'));var d;if(b=='fixed'){d={left:window.pageXOffset,top:window.pageYOffset};d.width=m.width();d.height=m.height()}else{d=this.$el.offset();d.width=this.$el.innerWidth();d.height=this.$el.innerHeight()}if(a=='cover'){var e=Math.max(d.width/this.backgroundWidth,d.height/this.backgroundHeight);var f=this.backgroundWidth*e;var g=this.backgroundHeight*e}else if(a=='contain'){var e=Math.min(d.width/this.backgroundWidth,d.height/this.backgroundHeight);var f=this.backgroundWidth*e;var g=this.backgroundHeight*e}else{a=a.split(' ');var f=a[0]||'';var g=a[1]||f;if(isPercentage(f)){f=d.width*parseFloat(f)/100}else if(f!='auto'){f=parseFloat(f)}if(isPercentage(g)){g=d.height*parseFloat(g)/100}else if(g!='auto'){g=parseFloat(g)}if(f=='auto'&&g=='auto'){f=this.backgroundWidth;g=this.backgroundHeight}else{if(f=='auto'){f=this.backgroundWidth*(g/this.backgroundHeight)}if(g=='auto'){g=this.backgroundHeight*(f/this.backgroundWidth)}}}var h=c[0];var i=c[1];if(isPercentage(h)){h=d.left+(d.width-f)*parseFloat(h)/100}else{h=d.left+parseFloat(h)}if(isPercentage(i)){i=d.top+(d.height-g)*parseFloat(i)/100}else{i=d.top+parseFloat(i)}var j=this.$el.offset();this.renderProgram.uniforms.topLeft=new Float32Array([(j.left-h)/f,(j.top-i)/g]);this.renderProgram.uniforms.bottomRight=new Float32Array([this.renderProgram.uniforms.topLeft[0]+this.$el.innerWidth()/f,this.renderProgram.uniforms.topLeft[1]+this.$el.innerHeight()/g]);var k=Math.max(this.canvas.width,this.canvas.height);this.renderProgram.uniforms.containerRatio=new Float32Array([this.canvas.width/k,this.canvas.height/k])},initShaders:function(){var a=['attribute vec2 vertex;','varying vec2 coord;','void main() {','coord = vertex * 0.5 + 0.5;','gl_Position = vec4(vertex, 0.0, 1.0);','}'].join('\n');this.dropProgram=createProgram(a,['precision highp float;','const float PI = 3.141592653589793;','uniform sampler2D texture;','uniform vec2 center;','uniform float radius;','uniform float strength;','varying vec2 coord;','void main() {','vec4 info = texture2D(texture, coord);','float drop = max(0.0, 1.0 - length(center * 0.5 + 0.5 - coord) / radius);','drop = 0.5 - cos(drop * PI) * 0.5;','info.r += drop * strength;','gl_FragColor = info;','}'].join('\n'));this.updateProgram=createProgram(a,['precision highp float;','uniform sampler2D texture;','uniform vec2 delta;','varying vec2 coord;','void main() {','vec4 info = texture2D(texture, coord);','vec2 dx = vec2(delta.x, 0.0);','vec2 dy = vec2(0.0, delta.y);','float average = (','texture2D(texture, coord - dx).r +','texture2D(texture, coord - dy).r +','texture2D(texture, coord + dx).r +','texture2D(texture, coord + dy).r',') * 0.25;','info.g += (average - info.r) * 2.0;','info.g *= 0.995;','info.r += info.g;','gl_FragColor = info;','}'].join('\n'));l.uniform2fv(this.updateProgram.locations.delta,this.textureDelta);this.renderProgram=createProgram(['precision highp float;','attribute vec2 vertex;','uniform vec2 topLeft;','uniform vec2 bottomRight;','uniform vec2 containerRatio;','varying vec2 ripplesCoord;','varying vec2 backgroundCoord;','void main() {','backgroundCoord = mix(topLeft, bottomRight, vertex * 0.5 + 0.5);','backgroundCoord.y = 1.0 - backgroundCoord.y;','ripplesCoord = vec2(vertex.x, -vertex.y) * containerRatio * 0.5 + 0.5;','gl_Position = vec4(vertex.x, -vertex.y, 0.0, 1.0);','}'].join('\n'),['precision highp float;','uniform sampler2D samplerBackground;','uniform sampler2D samplerRipples;','uniform vec2 delta;','uniform float perturbance;','varying vec2 ripplesCoord;','varying vec2 backgroundCoord;','void main() {','float height = texture2D(samplerRipples, ripplesCoord).r;','float heightX = texture2D(samplerRipples, vec2(ripplesCoord.x + delta.x, ripplesCoord.y)).r;','float heightY = texture2D(samplerRipples, vec2(ripplesCoord.x, ripplesCoord.y + delta.y)).r;','vec3 dx = vec3(delta.x, heightX - height, 0.0);','vec3 dy = vec3(0.0, heightY - height, delta.y);','vec2 offset = -normalize(cross(dy, dx)).xz;','float specular = pow(max(0.0, dot(offset, normalize(vec2(-0.6, 1.0)))), 4.0);','gl_FragColor = texture2D(samplerBackground, backgroundCoord + offset * perturbance) + specular;','}'].join('\n'));l.uniform2fv(this.renderProgram.locations.delta,this.textureDelta)},initTexture:function(){this.backgroundTexture=l.createTexture();l.bindTexture(l.TEXTURE_2D,this.backgroundTexture);l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,1);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.LINEAR);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.LINEAR)},setTransparentTexture:function(){l.bindTexture(l.TEXTURE_2D,this.backgroundTexture);l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,o)},hideCssBackground:function(){var a=this.$el[0].style.backgroundImage;if(a=='none'){return}this.originalInlineCss=a;this.originalCssBackgroundImage=this.$el.css('backgroundImage');this.$el.css('backgroundImage','none')},restoreCssBackground:function(){this.$el.css('backgroundImage',this.originalInlineCss||'')},dropAtPointer:function(a,b,c){var zoom=document.body.style.zoom||1;var d=parseInt(this.$el.css('border-left-width'))||0,borderTop=parseInt(this.$el.css('border-top-width'))||0;this.drop(a.pageX/zoom-this.$el.offset().left-d,a.pageY/zoom-this.$el.offset().top-borderTop,b,c)},drop:function(x,y,a,b){l=this.context;var c=this.$el.innerWidth();var d=this.$el.innerHeight();var e=Math.max(c,d);a=a/e;var f=new Float32Array([(2*x-c)/e,(d-2*y)/e]);l.viewport(0,0,this.resolution,this.resolution);l.bindFramebuffer(l.FRAMEBUFFER,this.framebuffers[this.bufferWriteIndex]);bindTexture(this.textures[this.bufferReadIndex]);l.useProgram(this.dropProgram.id);l.uniform2fv(this.dropProgram.locations.center,f);l.uniform1f(this.dropProgram.locations.radius,a);l.uniform1f(this.dropProgram.locations.strength,b);this.drawQuad();this.swapBufferIndices()},updateSize:function(){var a=this.$el.innerWidth(),newHeight=this.$el.innerHeight();if(a!=this.canvas.width||newHeight!=this.canvas.height){this.canvas.width=a;this.canvas.height=newHeight}},destroy:function(){this.$el.off('.ripples').removeClass('jquery-ripples').removeData('ripples');l=null;$(window).off('resize',this.updateSize);this.$canvas.remove();this.restoreCssBackground();this.destroyed=true},show:function(){this.visible=true;this.$canvas.show();this.hideCssBackground()},hide:function(){this.visible=false;this.$canvas.hide();this.restoreCssBackground()},pause:function(){this.running=false},play:function(){this.running=true},set:function(a,b){switch(a){case'dropRadius':case'perturbance':case'interactive':case'crossOrigin':this[a]=b;break;case'imageUrl':this.imageUrl=b;this.loadImage();break}}};var q=$.fn.ripples;$.fn.ripples=function(b){if(!n){throw new Error('Your browser does not support WebGL, the OES_texture_float extension or rendering to floating point textures.');}var c=(arguments.length>1)?Array.prototype.slice.call(arguments,1):undefined;return this.each(function(){var a=$(this),data=a.data('ripples'),options=$.extend({},p.DEFAULTS,a.data(),typeof b=='object'&&b);if(!data&&typeof b=='string'){return}if(!data){a.data('ripples',(data=new p(this,options)))}else if(typeof b=='string'){p.prototype[b].apply(data,c)}})};$.fn.ripples.Constructor=p;$.fn.ripples.noConflict=function(){$.fn.ripples=q;return this}})));